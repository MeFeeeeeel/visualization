<!DOCTYPE html>
<html style="height:100%;">

<head>
	<title></title>
	<style type="text/css">
		html {
			height: 100%;
		}

		body {
			height: 100%;
		}

		.box {
			width: 40px;
			height: 40px;
			background-color: lightgray;
			border: 1px solid black;
			float: left;
		}

		#hanuel {
			width: 100%;
			height: 100%;
		}

		.overview-body {
			background-color: rgba(0, 0, 0, 0.03);
		}

		.overview-p {
			display: inline;
			font-size: 40px;
			font-weight: 400%;
			font-family: "Lato", sans-serif;
		}
	</style>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
		integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" />
	<script src="cytoscape.min.js"></script>
	<script src="https://code.jquery.com/jquery.min.js"></script>

	<link href="https://fonts.googleapis.com/css?family=Lato&display=swap" rel="stylesheet" />

	<script src="https://kit.fontawesome.com/f51c7c1621.js" crossorigin="anonymous"></script>

	<script type="text/javascript">

		const val = `{'clouds': [{'Data': {'compute': {'i-0b0818412259ea6f9': {'VpcId': 'vpc-e904c482', 'SubnetId': 'subnet-bebc9af2'}, 'i-0e825a076ae3c0a45': {'VpcId': 'vpc-096dd0497219372e8', 'SubnetId': 'subnet-03def257f73fcb38d'}}, 'database': {'terraform-20191001195726502900000001': {'VpcId': 'vpc-e904c482', 'SubnetId': ['subnet-497a8822', 'subnet-bebc9af2', 'subnet-1715ba6c']}, 'database-server': {'VpcId': 'vpc-04a58794b18d7adb2', 'SubnetId': ['subnet-03caf6545b12099f6', 'subnet-0e3bc50b2594c84c7', 'subnet-06ebe45115cf8c76a']}}, 'storage': ['fulloption', 'nevation'], 'router': {'rtb-003b2bea452d196d0': {'VpcId': 'vpc-04a58794b18d7adb2'}, 'rtb-084387e06659db043': {'VpcId': 'vpc-096dd0497219372e8'}, 'rtb-8148c1ea': {'VpcId': 'vpc-e904c482'}, 'rtb-08273ed4185985470': {'VpcId': 'vpc-07d96df6b318d1413'}}}, 'Name': 'aws', 'Vendor': 'aws'}, {'Data': {'compute': {}, 'database': {}, 'storage': ['mf-storage-test-1', 'mf-storage-test-2', 'mf-storage-test-3', 'mf-storage-test-4', 'mf-testing-cloudfront-1', 'mf-testing-cloudfront-2', 'mf-testing-cloudfront-3', 'mf-testing-cloudfront-4', 'mfcloudbucket'], 'router': {'rtb-005377dbc91404e10': {'VpcId': 'vpc-003507d94145454aa'}, 'rtb-04319b7b0e1137690': {'VpcId': 'vpc-083f10707970eb857'}, 'rtb-07e5adb6edd40553f': {'VpcId': 'vpc-07b290e1bf0e584e9'}, 'rtb-0d005c3bc63ca6534': {'VpcId': 'vpc-0069df537563d8fb3'}, 'rtb-cac44da1': {'VpcId': 'vpc-908d4dfb'}}}, 'Name': 'Testing1', 'Vendor': 'aws'}, {'Data': {'compute': {'cirros-pro': {'VpcId': 'b39fd97e-8120-44f0-abf6-9e051117a695', 'SubnetId': 'fc520440-9a42-4c7d-bf27-da9cae8c7412'}, 'BB': {'VpcId': 'b39fd97e-8120-44f0-abf6-9e051117a695', 'SubnetId': 'fc520440-9a42-4c7d-bf27-da9cae8c7412'}, 'AA': {'VpcId': '7c71cc70-93d6-4d2a-b2e7-96b0832acebe', 'SubnetId': 'ab809640-d08f-4183-8b30-70bc99712aad'}, 'CC': {'VpcId': '7c71cc70-93d6-4d2a-b2e7-96b0832acebe', 'SubnetId': 'ab809640-d08f-4183-8b30-70bc99712aad'}, 'test_group': {'VpcId': 'b39fd97e-8120-44f0-abf6-9e051117a695', 'SubnetId': 'fc520440-9a42-4c7d-bf27-da9cae8c7412'}}}, 'Name': 'myopenstack', 'Vendor': 'openstack'}, {'Data': {'compute': {'1550905017690517947': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default', 'SubnetId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/asia-northeast2/subnetworks/default'}, '1207577375128509555': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default', 'SubnetId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/asia-northeast2/subnetworks/default'}}, 'database': {}, 'storage': ['bobtestbucket01'], 'router': {'3468004837521651950': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '4481417721225968410': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '130261129028991215': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '8088496238979965316': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/gcp-test-1'}, '6020210473663757081': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '4076544167982955282': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '8984036330821417750': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '8014744516572511003': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '725158530961668333': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '5824919315736984338': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '6033194743915117313': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '6376263185192745752': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '4513587795072153838': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '8833072714307330457': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/gcp-test-1'}, '2968119125848757428': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/gcp-test-1'}, '4399122475637570322': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '8689306488034851606': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '3183327258304551764': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/test'}, '5758085316759026452': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '1115360411497036566': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '8657704835917789667': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/gcp-test'}, '8080684062841273116': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '5547860123752364823': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '3223275646772812580': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/test'}, '5183848348184984053': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/gcp-test'}, '8727247116731185941': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '7040642888707898133': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}, '4021341064996616980': {'VpcId': 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default'}}}, 'Name': 'mygcp', 'Vendor': 'gcp'}, {'Data': {'compute': {'winMachine': {'VpcId': '/subscriptions/d144993d-d6a6-4bb4-a7fc-994916349ba2/resourceGroups/EduResourceGroup/providers/Microsoft.Network/virtualNetworks/EduResourceGroup-vnet', 'SubnetId': '/subscriptions/d144993d-d6a6-4bb4-a7fc-994916349ba2/resourceGroups/EduResourceGroup/providers/Microsoft.Network/virtualNetworks/EduResourceGroup-vnet/subnets/default'}}, 'storage': ['eduresourcegroupdiag', 'sqlvas5ofyw63ljua2'], 'database': {'sqlDB01': {'VpcId': 'koreacentral', 'SubnetId': ''}, 'postgrebobdb01': {'VpcId': 'koreacentral', 'SubnetId': ''}, 'master': {'VpcId': 'koreacentral', 'SubnetId': ''}}}, 'Name': 'myazure', 'Vendor': 'azure'}]}`
		const check_val = `{'summarys': [{'aws': {'vpc-096dd0497219372e8': '2/1', 'sg-08779b5512cc42fec': '0/2', 'sg-0235a9d08810b1507': '0/2', 'sg-02b491ad5006805a6': '0/2', 'sg-015c5877afc8583d8': '0/2', 'i-0b0818412259ea6f9': '0/1', 'vpc-04a58794b18d7adb2': '2/1', 'acl-0ce5fdec2ac41e4dd': '2/0', 'sg-027483c4e1089f4ee': '0/2', 'database-server': '2/3', 'E3LEMMTTONMLMY': '2/0', 'sg-0bf4156bf95dd53ec': '0/2', 'acl-0647b18821b8f3570': '2/0', 'i-0e825a076ae3c0a45': '0/1', 'sg-013b6bb678432c753': '0/2', 'acl-56a21f3d': '2/0', 'sg-0b9b6a19e43f02563': '0/2', 'vpn-09825e28c861e6a64': '0/1', 'sg-0f5f275292cc61580': '0/2', 'nevation': '2/1', 'sg-01144d8bd171d5382': '0/2', 'sg-01a42e0659efcfbdc': '0/2', 'point': '29/49', 'EIRQF7VCI6OO0': '1/1', 'sg-055ece670df0b4fc9': '0/2', 'sg-02596c39f95615903': '0/2', 'terraform-20191001195726502900000001': '2/3', 'vpc-07d96df6b318d1413': '2/1', 'fulloption': '2/1', 'sg-053da0c30b3c9340f': '0/2', 'sg-006393d2994f966bf': '0/2', 'E7GU2UR4026OP': '2/0', 'sg-92b0abfc': '0/2', 'vpc-e904c482': '1/2'}}, {'Testing1': {'mf-testing-cloudfront-1': '0/3', 'sg-09c8f1951581b2929': '0/2', 'E2YG0DPLSU49PI': '2/0', 'sg-5455593a': '0/2', 'vpc-083f10707970eb857': '2/1', 'E375ODTZ30TGGA': '2/0', 'mf-storage-test-2': '1/2', 'sg-0ed973637c0b7bf23': '0/2', 'sg-09e9b183a5dafccad': '0/2', 'mfcloudbucket': '1/2', 'sg-0e088ca4355f31be7': '0/2', 'E254RLJNKWI1ND': '2/0', 'point': '19/40', 'mf-testing-cloudfront-2': '0/3', 'mf-testing-cloudfront-4': '0/3', 'vpc-908d4dfb': '0/3', 'mf-storage-test-4': '1/2', 'mf-storage-test-3': '2/1', 'ED0DAAQVG1XLK': '1/1', 'mf-storage-test-1': '2/1', 'ECJN2DIYRR64T': '1/1', 'mf-testing-cloudfront-3': '0/3'}}, {'myopenstack': {'BB': '1/0', 'test_group': '0/1', 'point': '4/1', 'CC': '1/0', 'cirros-pro': '1/0', 'AA': '1/0'}}, {'mygcp': {'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/asia-northeast1/subnetworks/default': '0/1', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/us-east1/subnetworks/test': '1/0', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/europe-west4/subnetworks/default': '0/1', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/asia-east1/subnetworks/gcp-subnet': '1/0', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/test': '3/0', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/southamerica-east1/subnetworks/default': '0/1', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/us-east1/subnetworks/default': '0/1', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/gcp-test': '3/0', '295533163055435111': '2/0', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/europe-west2/subnetworks/default': '0/1', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/asia-northeast2/subnetworks/gcp-test-1': '0/1', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/gcp-test-1': '3/0', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/us-west2/subnetworks/default': '0/1', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/europe-west6/subnetworks/default': '0/1', '8415984013515816688': '0/2', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/asia-northeast2/subnetworks/default': '0/1', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/northamerica-northeast1/subnetworks/default': '0/1', '1550905017690517947': '5/1', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/asia-south1/subnetworks/default': '0/1', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/asia-east1/subnetworks/default': '0/1', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/asia-east2/subnetworks/default': '0/1', '1207577375128509555': '3/3', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/europe-west1/subnetworks/default': '0/1', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/us-west1/subnetworks/default': '0/1', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/australia-southeast1/subnetworks/default': '0/1', 'point': '22/30', 'bobtestbucket01': '0/1', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/asia-southeast1/subnetworks/default': '0/1', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/us-central1/subnetworks/default': '0/1', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/europe-west3/subnetworks/default': '0/1', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/us-east4/subnetworks/default': '0/1', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/global/networks/default': '1/2', 'https://www.googleapis.com/compute/v1/projects/dark-torch-252917/regions/europe-north1/subnetworks/default': '0/1'}}, {'myazure': {'/subscriptions/d144993d-d6a6-4bb4-a7fc-994916349ba2/resourceGroups/EduResourceGroup/providers/Microsoft.Network/virtualNetworks/EduResourceGroup-vnet-DB/subnets/default': '1/0', 'point': '7/7', '/subscriptions/d144993d-d6a6-4bb4-a7fc-994916349ba2/resourceGroups/EduResourceGroup/providers/Microsoft.Storage/storageAccounts/eduresourcegroupdiag': '1/0', '/subscriptions/d144993d-d6a6-4bb4-a7fc-994916349ba2/resourceGroups/EduResourceGroup/providers/Microsoft.Network/virtualNetworks/EduResourceGroup-vnet/subnets/sec_default': '0/1', '/subscriptions/d144993d-d6a6-4bb4-a7fc-994916349ba2/resourceGroups/EduResourceGroup/providers/Microsoft.Network/virtualNetworks/EduResourceGroup-vnet/subnets/default': '1/0', '/subscriptions/d144993d-d6a6-4bb4-a7fc-994916349ba2/resourceGroups/EduResourceGroup/providers/Microsoft.Sql/servers/sqldbserverbob01/firewallRules/ClientIPAddress_2019-11-28_19-51-4': '1/0', '/subscriptions/d144993d-d6a6-4bb4-a7fc-994916349ba2/resourceGroups/EduResourceGroup/providers/Microsoft.Network/networkSecurityGroups/winMachine-nsg': '0/1', '/subscriptions/d144993d-d6a6-4bb4-a7fc-994916349ba2/resourceGroups/EduResourceGroup/providers/Microsoft.Storage/storageAccounts/sqlvas5ofyw63ljua2': '0/1', '/subscriptions/d144993d-d6a6-4bb4-a7fc-994916349ba2/resourceGroups/EduResourceGroup/providers/Microsoft.DBforPostgreSQL/servers/postgrebobdb01': '0/1', '/subscriptions/d144993d-d6a6-4bb4-a7fc-994916349ba2/resourceGroups/EduResourceGroup/providers/Microsoft.Network/virtualNetworks/testVirtual-vnet/subnets/default01': '0/1', '/subscriptions/d144993d-d6a6-4bb4-a7fc-994916349ba2/resourceGroups/EduResourceGroup/providers/Microsoft.Sql/servers/sqldbserverbob01/firewallRules/AllowAllWindowsAzureIps': '0/1', '/subscriptions/d144993d-d6a6-4bb4-a7fc-994916349ba2/resourceGroups/EduResourceGroup/providers/Microsoft.Compute/virtualMachines/winMachine': '1/0'}}]}`

		var convert_check_list_data = JSON.parse(check_val.replace(/'/gi, '"'))['summarys']
		var cloud_data = "";

		var instance_list = [];
		var instance_dict = {};
		var subnet_dict = {};

		var instance_edges = [];
		var instance_nodes = [];

		var cyto = null;
		var detail_url = ''

		function go_detail_url() {
			window.location.href = detail_url
		}

		function convert_check_data() {
			var tmp = {}

			for (var i = 0; i < convert_check_list_data.length; i++) {
				var ven = Object.keys(convert_check_list_data[i])[0]
				tmp[ven] = convert_check_list_data[i][ven]
			}

			convert_check_list_data = tmp
		}

		function init_all_cnt() {
			var all_win = 0
			var all_lose = 0

			for (var i in convert_check_list_data) {
				var point = convert_check_list_data[i]['point'].split("/")
				var win = point[0]
				var lose = point[1]

				if (win != "None") {
					all_win += parseInt(win)
				}

				if (lose != "None") {
					all_lose += parseInt(lose)
				}

			}
			$("#all_success").text(all_win)
			$("#all_danger").text(all_lose)
		}


		function find_provider(id) {
			for (var i = 0; i < cloud_data.clouds.length; i++) {
				if (cloud_data.clouds[i].Name == id) {
					return cloud_data.clouds[i].Vendor
				}
				if (JSON.stringify(cloud_data.clouds[i].Data).indexOf(id) != -1) {
					return cloud_data.clouds[i].Vendor
				}
			}
		}

		function find_instance_type(id) {
			for (var i = 0; i < cloud_data.clouds.length; i++) {
				if (cloud_data.clouds[i].Name == id) {
					if (cloud_data.clouds[i].Vendor == "openstack") {
						return "private cloud"
					} else {
						return "public cloud"
					}
				}

				var keys = Object.keys(cloud_data.clouds[i].Data)

				for (var j = 0; j < keys.length; j++) {
					var type = keys[j]
					var instance_key = Object.keys(cloud_data.clouds[i].Data[type])

					for (var k = 0; k < instance_key.length; k++) {
						var instance_id = instance_key[k]
						var subnet = cloud_data.clouds[i].Data[type][instance_id]['SubnetId']
						if (subnet != undefined && JSON.stringify(subnet).indexOf(id) != -1) {
							return "subnet"
						}

						var vpc = cloud_data.clouds[i].Data[type][instance_id]['VpcId']
						if (vpc != undefined && JSON.stringify(vpc).indexOf(id) != -1) {
							if (cloud_data.clouds[i].Vendor == "openstack") {
								return "network name"
							}
							return "vpc"
						}
					}

					if (JSON.stringify(cloud_data.clouds[i].Data[type]).indexOf(id) != -1) {
						return type
					}
				}
			}
			return null
		}

		function find_point(id) {
			if (convert_check_list_data[id] == undefined) {
				for (var i in convert_check_list_data) {
					if (convert_check_list_data[i][id] != undefined) {
						return convert_check_list_data[i][id]
					}
				}

				// No GCP /
				return "0/0"
			} else {
				return convert_check_list_data[id].point
			}

		}


		$(document).ready(function () {
			convert_check_data()
			$("#modal").modal({ show: false });
			draw_map();
		});


		var n1n2 = "";
		function make_cytoscape() {
			var style_str = "cytoscape.stylesheet()";
			style_str += `.selector('node').css({'height': 80,'width': 80,'background-fit': 'cover','border-opacity': 0.5,'label': 'data(id)', 'color': 'black', "border-color": 'black', "border-opacity": "1", 'border-width': '2px', 'background-color':'white', 'shape': 'round-rectangle'})
	  			.selector('.none').css({'display': 'none'})
	  			.selector('.warning').css({'border-color': 'red', 'border-width': '3px', "border-opacity": "0.8"})
				.selector('.router').css({'line-color': '#4c505f'})
				.selector('.database').css({'line-color': 'green'})
				.selector('.subnet').css({'width': '100px', 'height': '100px'})
				.selector('.vpc').css({'width': '120px', 'height': '120px'})
				.selector('.vendor').css({'font-size': '40px', 'color':'black', 'border-width': '5px', 'width': '160px', 'height': '160px'})`;

			for (var i = 0; i < instance_list.length; i++) {
				let id = instance_list[i];
				let type = find_instance_type(id);
				let vendor = find_provider(id);

			    style_str += ".selector('#" + id + "').css({'background-image': '/Media/Media/img/" + type + "-solid-" + vendor + ".png'})"
            }
            
            for (var i = 0; i < instance_nodes.length; i++){
                if ("parent" in instance_nodes[i].data && instance_nodes[i].data.id != undefined){
                    var parent_id = instance_nodes[i].data.parent
                    instance_edges.push({data:{source: instance_nodes[i].data.id, target:parent_id}})
                    delete instance_nodes[i].data.parent
                }
            }

			cyto = cytoscape({
				container: document.getElementById("haneul"),
				boxSelectionEnabled: false,
				autounselectify: true,
				wheelSensitivity: 0.5,
				style: eval(style_str),
				elements: {
					nodes: instance_nodes,
					edges: instance_edges
				},
				layout: {
					name: "cose"
				}
			});



			cyto.on("tap", "node", event => {
				const modal_body = document.querySelector(".modal-body");
				const modal_parent_div = document.querySelector("#parent_name_div");
				let instance_name = event.target.id();

				let instance_type;
				let provider;
				let parent_name;

				n1n2 = event.target

				provider = find_provider(instance_name)
				instance_type = find_instance_type(instance_name)
				detail_url = './check_list?id=' + instance_name + '&type=' + instance_type + '&provider=' + provider

				if (event.target.parent().id()) {
					parent_name = event.target.parent().id();
					document.querySelector("#parent_name").innerText = parent_name;
					modal_parent_div.style.display = "block";
				} else {
					document.querySelector("#parent_name").innerText = "";
					modal_parent_div.style.display = "none";
				}

				document.querySelector("#instance_type").innerText = instance_type
				document.querySelector("#instance_name").innerText = instance_name;
				document.querySelector("#provider").innerText = provider;

				$("#modal").modal();
				var data = find_point(event.target.id())

				if (data == undefined) {
					data = find_point(event.target.id().split("] ")[1])
				}
				$('#success_count').text(data.split("/")[0])
				$('#danger_count').text(data.split("/")[1])
			});
		}

		function is_subnet_dict(subnet) {
			for (var sub in subnet_dict) {
				if (sub == subnet) {
					return sub;
				}
			}
			return false;
		}

		function get_vpc_element(vpc) {
			var rst = []
			for (var sub in subnet_dict) {
				if (subnet_dict[sub] == vpc) {
					rst.push(sub)
				}
			}


			for (var i = 0; i < cloud_data.clouds.length; i++) {
				var db = cloud_data["clouds"][i].Data.database

				for (var idx in db) {
					if (db[idx].VpcId == vpc) {
						rst.push(idx)
					}
				}
			}
			return rst
		}

		function make_map(data) {
			for (var i = 0; i < data.clouds.length; i++) {
				var cloud = data.clouds[i];
				var cloud_id = cloud.Name

				var cloud_data = { data: { id: cloud_id }, classes: 'vendor' }

				if (find_point(cloud_id).split("/")[1] != "0") {
					cloud_data['classes'] = ['warning', 'vendor']
				}

				instance_nodes.push(cloud_data)

				var database = cloud.Data.database
				var compute = cloud.Data.compute
				var router = cloud.Data.router
				var storage = cloud.Data.storage

				for (var id in compute) {
					instance_dict[id] = [compute[id].SubnetId];
					if (!is_subnet_dict(compute[id].SubnetId)) {
						subnet_dict[compute[id].SubnetId] = compute[id].VpcId;
						var in_data = { data: { id: compute[id].VpcId, parent: cloud_id }, classes: ['vpc'] }

						if (find_point(compute[id].VpcId).split("/")[1] != "0") {
							in_data['classes'] = ['warning', 'vpc']
						}

						instance_nodes.push(in_data)
					}

					instance_list.push(id);
				}

				for (var id in database) {
					if (database[id].SubnetId == ""){
						var in_data = { data: { id: id, parent: cloud_id } }
							if (find_point(id).split("/")[1] != "0") {
								in_data['classes'] = ['warning']
							}

						instance_nodes.push(in_data)
						instance_list.push(id);	
						continue
					}


                    
					var in_data = { data: { id: database[id].VpcId, parent: cloud_id }, classes: ['vpc']}
                    
                    if (find_point(database[id].VpcId).split("/")[1] != "0") {
						in_data['classes'] = ['warning', 'vpc']
					}

                    instance_nodes.push(in_data)
                    
                    in_data = {data: { id: id, parent: database[id].VpcId}}
                    if (find_point(id).split("/")[1] != "0") {
						in_data['classes'] = ['warning']
					}
                    instance_nodes.push(in_data)

					instance_list.push(id);
				}

				for (var idx in storage){
					instance_nodes.push({ data: { 'id': storage[idx], 'parent': cloud_id } })
					instance_list.push(storage[idx])
				}
			}
		}

		function draw_map() {
			let i;
			const data = JSON.parse(val.replace(/'/gi, '"'));
			cloud_data = data;
			make_map(data);

			for (var idx in instance_dict) {
				var p = find_point(idx)
				if (instance_dict[idx].length == 0){ continue }
				else if (instance_dict[idx].length == 1) {
					var in_data = { data: { id: idx, parent: instance_dict[idx][0] } }

					if (p.split("/")[1] != "0") {
						in_data['classes'] = ['warning']
					}
					instance_nodes.push(in_data);
				} else {
					var in_data = { data: { id: idx, parent: subnet_dict[instance_dict[idx][0]] }, classes: ['subnet'] }

					if (p.split("/")[1] != "0") {
						in_data['classes'] = ['warning', 'subnet']
					}

					instance_nodes.push(in_data);

					for (i = 0; i < instance_dict[idx].length; i++) {
						instance_nodes.push({
							data: { parent: instance_dict[idx][i] },
							classes: "none"
						});
						instance_edges.push({
							data: { source: idx, target: instance_dict[idx][i] },
							classes: 'database'
						});
					}
				}
			}

			for (var idx in subnet_dict) {
				var in_data = { 'data': { id: idx, parent: subnet_dict[idx] }, classes: ['subnet'] }
				var p = find_point(idx)
				if (p.split("/")[1] != "0") {
					in_data['classes'] = ['warning', 'subnet']
				}

				instance_nodes.push(in_data);
			}

			make_cytoscape();
			init_all_cnt()
		}
	</script>
</head>

<body style="height:100%;">
	<div id="haneul" style="float: left; height: 100%; width: 90%;border: 1px solid black;"></div>

	<div style="height: 40%; width: 100%">
		<textarea style="width:95%; height: 100%;;float: left;"> </textarea>
		<button style="height: 100%;float: left;">Click!</button>
	</div>
	<div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
		aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLongTitle">
						Instance Overview
					</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="container">
						<div>
							provider:
							<p id="provider"></p>
						</div>

						<div>
							instance_type:
							<p id="instance_type"></p>
						</div>

						<div>
							instance_name:
							<p id="instance_name"></p>
						</div>

						<div id="parent_name_div">
							parent_name:
							<p id="parent_name"></p>
						</div>

						<div class="row mb-5">
							<div class="col-2"></div>
							<div class="card col-8 text-center overview-body">
								<div class="card-body">
									<i class="fas fa-check-circle text-muted fa-2x mr-1 ml-4"></i>
									<p id="success_count" class="overview-p mr-5">0</p>
									<i class="fas fa-exclamation-triangle text-muted fa-2x mr-1"></i>
									<p id="warning_count" class="overview-p mr-5">0</p>
									<i class="fas fa-times-circle text-muted fa-2x mr-1"></i>
									<p id="danger_count" class="overview-p mr-5">0</p>
								</div>
							</div>
							<div class="col-2"></div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">
						Close
					</button>
					<button type="button" class="btn btn-primary">Save changes</button>
				</div>
			</div>
		</div>
	</div>

	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
		integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
		crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
		integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
		crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
		integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
		crossorigin="anonymous"></script>
</body>

</html>