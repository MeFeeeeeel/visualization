<!DOCTYPE html>
<html style="height:100%;">
<head>
	<title></title>
	<style type="text/css">
		html { height:100%;}
		body {height: 100%;}
		.box{width: 40px; height: 40px; background-color: lightgray; border: 1px solid black; float: left;}
		#hanuel { width: 100%; height: 100%; }
	</style>
	<script src="cytoscape.min.js"></script>
	<script src="https://code.jquery.com/jquery.min.js"></script>

	<script type="text/javascript">
    	const val = `{'clouds': [{'type': 'aws', 'instance': [{'type': 'ec2', 'arounds': [{'type': 'vpc', 'id': 'vpc-e904c482', 'around': ['i-08de8a736ac672fc3', 'i-03b191c36d03ec8e7', 'i-0fb807f2f0de5d0db', 'i-0e6f538ceed326f4d']}], 'code': 'i-06b5f0d332021cbc1'}, {'type': 'ec2', 'arounds': [{'type': 'vpc', 'id': 'vpc-e904c482', 'around': ['i-06b5f0d332021cbc1', 'i-03b191c36d03ec8e7', 'i-0fb807f2f0de5d0db', 'i-0e6f538ceed326f4d']}], 'code': 'i-08de8a736ac672fc3'}, {'type': 'ec2', 'arounds': [{'type': 'vpc', 'id': 'vpc-e904c482', 'around': ['i-06b5f0d332021cbc1', 'i-08de8a736ac672fc3', 'i-0fb807f2f0de5d0db', 'i-0e6f538ceed326f4d']}], 'code': 'i-03b191c36d03ec8e7'}, {'type': 'ec2', 'arounds': [{'type': 'vpc', 'id': 'vpc-e904c482', 'around': ['i-06b5f0d332021cbc1', 'i-08de8a736ac672fc3', 'i-03b191c36d03ec8e7', 'i-0e6f538ceed326f4d']}], 'code': 'i-0fb807f2f0de5d0db'}, {'type': 'ec2', 'arounds': [{'type': 'vpc', 'id': 'vpc-e904c482', 'around': ['i-06b5f0d332021cbc1', 'i-08de8a736ac672fc3', 'i-03b191c36d03ec8e7', 'i-0fb807f2f0de5d0db']}], 'code': 'i-0e6f538ceed326f4d'}, {'type': 'ec2', 'arounds': [{'type': 'vpc', 'id': 'vpc-096dd0497219372e8', 'around': []}], 'code': 'i-0e825a076ae3c0a45'}], 'name': 'mfcloud'}]}`
    

		var around_list = []
		var instance_list = []
		var compelete_instance = []
		var compelete_arounds = []

		var instance_edges = []
		var instance_nodes = []

		var cyto = null


		$(document).ready(function(){
			draw_map()

			$("button").click(function(){
				edges = []
				nodes = []
				instance_list = []
				convert_instance_list = []
				compelete_instance = []
				sig.graph.clear()

				draw_map()
			})
		})
		var n1n2 = ''
		function make_cytoscape(){
			var style_str = "cytoscape.stylesheet()"
			style_str += `.selector('node').css({
				'height': 80,
				'width': 80,
				'background-fit': 'cover',
				'border-color': '#000',
				'border-width': 1,
				'border-opacity': 0.5,
				'label': 'data(id)'
			})`

			for(var i = 1; i <= instance_list.length; i++){
				var id = "instance" + i;
				style_str +=
				".selector('#" + id +`')
					.css({
						'background-image': 'engine.png'
					})`
			}

			cyto = cytoscape({
				container: document.getElementById('hanuel'),
				boxSelectionEnabled: false,
				autounselectify: true,
				wheelSensitivity: 0.5,
				style: eval(style_str),
				elements:{
					nodes: instance_nodes,
					edges: instance_edges
				},
				layout:{
					name: 'grid',
					directed: true,
					padding: 10
				}
			})

			cyto.on("tap", "node", (event) => {
				n1n2 = event
				alert("Click Node!")
			})
		}

		function is_complete_arounds(id){
			for (var i = 0; i < compelete_arounds.length; i++){
				if (compelete_arounds[i] == id)
					return true
			}
			return false
		}

		function is_complete_instance(code){
			for (var i = 0; i < compelete_instance.length; i++){
				if (compelete_instance[i] == code)
					return true
			}
			return false
		}

		function find_instance(code){
			for (var i = 0; i < instance_list.length; i++){
				if (instance_list[i].code == code)
					return instance_list[i]
			}
			return null
		}

		function make_page(type, num){
			return {data: {id: type + num}}
		}

		function make_map(data){
			for (var i = 0; i < data.clouds.length; i++){
				var cloud = data.clouds[i]
				for (var j = 0; j < cloud.instance.length; j++){
					var instance = cloud.instance[j]
					instance_list.push(instance)
					for (var k = 0; k < instance.arounds.length; k++){
						around_list.push(instance.arounds[k])
					}
				}
			}
		}

		function find_instance_nodes(id){
			for (let i = 0; i < instance_nodes.length; i++){
				if (instance_nodes[i].data.id == id)
					return i
			}
			return -1
		}

		var gl = ''

		function draw_map(){
			let i;
            const data = JSON.parse(val.replace(/'/gi, '"'));
            make_map(data)
			gl = data
			
			for (i = 0; i < instance_list.length; i++){
                const instance = instance_list[i];
                instance_nodes.push({ data:{ id: instance.code } })
			}

			for (i = 0; i < around_list.length; i++){
                const around = around_list[i];
                if (around.around.length != 0)
                    instance_nodes.push({data: {id: around.id}})

				for (let j = 0; j < around.around.length; j++){
                    const idx = find_instance_nodes(around.around[j]);
                    instance_nodes[idx].data.parent = around.id
				}
			}


			// this is create edge code
			// we didn't use edge but ~~~
			// instance_edges.push({ data:{ source: "instance" + String(instance.code), target: "instance" + String(acode) }})


			make_cytoscape()
		}




	</script>

</head>
<body style="height:100%;">
	<div id="hanuel" style="float: left; height: 70%; width: 90%;border: 1px solid black;"></div>		

	<div style="height: 40%; width: 100%">
		<textarea style="width:95%; height: 100%;;float: left;">



		</textarea>
		<button style="height: 100%;float: left;">Click!</button>
	</div>
</body>
</html>